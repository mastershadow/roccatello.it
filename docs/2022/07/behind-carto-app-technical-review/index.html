<!doctype html><html lang="en"><head><title>A technical introduction to carto.app</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="generator" content="Eduard Roccatello"><meta name="generator" content="Hugo 0.150.0"><meta name="author" content="Eduard Roccatello"><meta name="description" content="A GIS Android app has a lot of stuff behind and it is amazingly complicated"><meta property="og:title" content="A technical introduction to carto.app"><meta property="og:site_name" content="Eduard Roccatello's GIS blog"><meta property="og:url" content="https://www.roccatello.it/2022/07/behind-carto-app-technical-review/"><meta property="og:description" content="A GIS Android app has a lot of stuff behind and it is amazingly complicated"><meta property="og:type" content="article"><meta property="og:image" content="https://www.roccatello.it/img/placeholder.jpg"><link href="init.ee2bdbeda8ae4e5525c6.css" rel="stylesheet"><script src="init.346aa.js"></script></head><body><nav class="navbar navbar-dark fixed-top bg-dark navbar-expand-lg" id="navbar-main"><div class="container"><a class="navbar-brand" href="/">Eduard Roccatello's GIS blog</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ms-auto"><li class="nav-item"><a class="nav-link" href="/#mondogis"><span>Tales from the GIS</span></a></li><li class="nav-item"><a class="nav-link" href="/post"><span>Articles</span></a></li><li class="nav-item"><a class="nav-link" href="/#showcase"><span>Showcase</span></a></li><li class="nav-item"><a class="nav-link" href="/#aboutme"><span>About</span></a></li><li class="nav-item"><a class="nav-link" href="/#contacts"><span>Contacts</span></a></li></ul></div></div></nav><article class="article" itemscope itemtype="http://schema.org/Article"><div class="p-3 bg-success text-light mb-0"><div class="container"><div class="row"><div class="col col-lg-8 offset-lg-2"><h2>A technical introduction to carto.app</h2><p class="lead">A GIS Android app has a lot of stuff behind and it is amazingly complicated</p></div></div></div></div><div class="bg-secondary"><div class="container text-light"><div class="d-flex justify-content-between align-items-center pt-3 pb-3 col col-lg-8 offset-lg-2"><div class="article-metadata"><span itemscope itemprop="author" itemtype="http://schema.org/Person"><meta itemprop="name" content="Eduard Roccatello"></span><span class="article-date"><meta content="2022-07-16 00:00:00 +0000 UTC" itemprop="datePublished"><time datetime="2022-07-16 00:00:00 +0000 UTC" itemprop="dateModified"><i class="fa fa-calendar fa-fw mr-1"></i>2022-07-16
</time></span><span itemscope itemprop="publisher" itemtype="http://schema.org/Person"><meta itemprop="name" content="Eduard Roccatello"></span><span class="middot-divider"></span>
<span class="article-reading-time"><i class="fa fa-clock fa-fw mr-1"></i>3 min read</span></div><div class="share-box" aria-hidden="true"><ul class="share list-inline m-0"><li class="list-inline-item"><a class="facebook text-light" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.roccatello.it%2f2022%2f07%2fbehind-carto-app-technical-review%2f" target="_blank" rel="noopener"><i class="fab fa-fw fa-facebook-f"></i></a></li><li class="list-inline-item"><a class="linkedin text-light" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.roccatello.it%2f2022%2f07%2fbehind-carto-app-technical-review%2f&amp;title=A%20technical%20introduction%20to%20carto.app" target="_blank" rel="noopener"><i class="fab fa-fw fa-linkedin-in"></i></a></li><li class="list-inline-item"><a class="email text-light" href="mailto:?subject=A%20technical%20introduction%20to%20carto.app&amp;body=https%3a%2f%2fwww.roccatello.it%2f2022%2f07%2fbehind-carto-app-technical-review%2f"><i class="fas fa-fw fa-envelope"></i></a></li></ul></div></div></div></div><div class="container"><div class="article-style row pt-4" itemprop="articleBody"><div class="col col-lg-8 offset-lg-2"><p>Among all things I do at work, I&rsquo;m leading the development of carto.app at <a href="https://www.3dgis.it">3DGIS</a>.</p><p>I&rsquo;ve been designing and developing the app since 2019, but I never had time to explain how it works, technically speaking.</p><p><strong>carto.app does a lot of things</strong>.<br>For the end user it allows to use, manage and collect geospatial data on the field. It is incredible for data surveys, maintenance activities and to access the whole spatial dataset with a couple of taps.
It has a lot of user features, for instance:</p><ul><li>multiple maps with dynamic web mercator projection in order to overlay with Google Maps / Openstreetmap</li><li>full data access to carto database (the remote one)</li><li>linear referencing in real time</li><li>geometry editing on mobile (for points, lines, polygons and their multi counterpart)</li><li>campaign backed data collection</li><li>traffic sign support</li></ul><h2 id="how-does-it-work">How does it work?</h2><p>carto.app relies on the 3DGIS mobile framework, which I&rsquo;m developming since 2015.
Mobile framework is a foundation upon carto.app relies in order to build its business logic.</p><h3 id="what-does-the-framework-account">What does the framework account?</h3><ul><li>features, geometry and math</li><li>spatial input output formats</li><li>graphical geometry rendering (computational geometry algorithms)</li><li>lifecycle management basics</li><li>spatial database support</li></ul><p>The first two bullets are straightforward but still not trivial. They require a lot of algoritms to be known by the team but once written they could be used just with trivial knowledge of the subject (for instance, you can call buffer() on a feature without knowing how to compute one).</p><p>The third one is challenging. Drawing geometries involves spatial projection, vector to raster conversion and clipping. Feature styling is also very hard to obtain in a reasonable amount of time (read it as FAST).</p><p>The fouth point accounts Android weirdness about lifecycle, permission and data sharing between activities and fragment. Unlike iOS, Android requires you take in account state and memory dumping.</p><p>Spatial database support is key feature of <strong>carto.app</strong>. We are using a custom version of a spatialite database, modified in order to run with Room ORM.</p><h2 id="campaign-management-primeror-how-we-dynamically-merge-remote-data-with-local-data">Campaign management primer.<br>Or how we dynamically merge remote data with local data</h2><p>One of the most user appreciated feature of carto.app is the way the app manages survey sessions.
Survey data is collected offline using the internal spatial database and organized in campaigns. A campaign is a survey session that can be uploaded to carto webGIS in order to be orchestrated with the main spatial infrastructure.</p><p>This allows operators to validate data before making them live and also to correct any possible conflict in data updates.</p><div class="mermaid" align="center">graph TD
A[Remote data] --> B(Live data)
C[Local data] --> B</div><p>This allows users to work on live data without any hassle.</p><p>But how does it work? Mainly we intercept every communication involving remote data and we update responses with local modification.</p><div class="mermaid" align="center">graph TD
A[Request Remote data] --> B[Response Interceptor]
B --> C[Check for local data]
C --> D[Merge and replace data]
D --> E[Returns data to caller]</div><h2 id="conclusions">Conclusions</h2><p>Developing a spatial app on a mobile platform is not hard as the multitude of apps you can find on the store demonstrates.
But delivering a desktop grade GIS experience on mobile is completely another different task.
In carto we manage data with complex relationships.
What happens when you update or clone a remote element on the app?
Or&mldr; how do you draw a set of 100 raster layers keeping a reasonable amount of frames per second?</p><p>carto.app is designed to manage these cases. Reality is complex, way more than academia.</p></div></div></div></article><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"><link href="main.ceec15bd736a22810641.css" rel="stylesheet"><footer class="bg-success text-light"><div class="container"><div class="row p-2"><div class="col"><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="link-light">CC BY-SA 4.0 by Eduard Roccatello</a></div><div class="col text-end"><a href="/privacy" class="link-light">Privacy policy</a></div></div></div></footer><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"><link href="main.ceec15bd736a22810641.css" rel="stylesheet"><script src="main.346aa.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></body></html>